# 智能车完全模型组 - 源
---
## 文件结构
- .metadata 为英飞凌IDE编译生成的文件，**勿动**
- CarRun_HuaHai_Hardware 为下位机程序源代码
- CarRun_HuaHai_Hardware_RTT 为移植了rtt操作系统的下位机程序源代码（放弃移植）
- CarRun_HuaHai_UpperComputer 为上位机相关内容
---
## 智能车工作源码（包含上下位机）
---
### 使用的平台
- 芯片使用的为英飞凌的tc264芯片
- IDE使用的为AURIX Development Studio
- 使用了逐飞提供的开源库，以减轻开发难度
- 百度edgeboard开发板，Linux系统开发上位机
---
### 相关的内容
- 全国大学生智能汽车竞赛完全模型组，底层控制代码功能：
    - [x] 1. 电机的运动控制（速度环+电流环）
    - [x] 2. 舵机的转向控制
    - [x] 3. 串口蓝牙的数据接收和解码（无线串口数据监视，手机蓝牙数据交换控制）
    - [x] 4. 上位机edgeboard的数据接收和解码，以实现小车的自动控制
    - [x] 5. 相关数据的flash存储 -> 在调试完成后的相关数据记录，以便下一次的初始化
    - [x] 6. 按键的数据读取，以进行发车及其他控制
    - [x] 7. 陀螺仪的初始化，及解算
    - [x] 8. 电池电压ADC采样，并蜂鸣器报警
---

版本改动：

...

V1.1    
1. 电流计基本测试完成，可以得到较为符合的电机电流数据，对于电流计采样的电机电流数据使用了一阶低通滤波（采用的库函数进行滤波）。 
2. 同时陀螺仪的姿态角解算还存在问题，yaw轴数据一直在大角度的漂移。（未解决）

V1.2    
1. 代码结构优化：将实时性要求不高的功能放入cpu0中去完成，例如adc电压采样报警、没有用到的陀螺仪解算、无线串口数据发送等等；将实时性要求较高的功能放入cpu1中实现，把上位机的数据接受中断和解算放入cpu1中，以及定时器中断用于电机控制的放入cpu1中。（后续测试，将用于电机闭环控制的定时器中断放入cpu1中读取不到电流值，不知道原因，故又将定时器中断放回cpu0了） 
2. 进行了电流环+速度环的代码编写和调试，pid参数来自于上位机发送，可以进行实时的调整而不需要重复的编译下载。（串级闭环调试失败，恢复到了之前的单环控制，将电流环的pid控制器注释了，重新调试只需要启用就可以）然后在输入设定目标速度的地方加入了一阶低通滤波器，存在些许的相位滞后，但是可以避免启动加速度过大对整车机械结构的伤害。

---

